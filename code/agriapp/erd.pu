@startuml
!define TABLE(name,desc) class name as "desc" << (T,#FFAAAA) >>
!define PK(x) <u>x</u>
!define FK(x) x

' User-related entities
TABLE(User, "User") {
  PK(id): UUID
  email: VARCHAR(255)
  first_name: VARCHAR(100)
  last_name: VARCHAR(100)
  avatar_url: VARCHAR(255)
  date_of_birth: DATE
  state: VARCHAR(50)
  gender: ENUM
  user_type: ENUM
  created_at: TIMESTAMP
  updated_at: TIMESTAMP
}

TABLE(Client, "Client") {
  PK(id): UUID
  FK(user_id): UUID
}

TABLE(AgriculturalExpert, "Agricultural Expert") {
  PK(id): UUID
  FK(user_id): UUID
  salary: DECIMAL(10,2)
}

TABLE(Supervisor, "Supervisor") {
  PK(id): UUID
  FK(user_id): UUID
}

' Subscription-related entities
TABLE(Subscription, "Subscription") {
  PK(id): UUID
  FK(user_id): UUID
  FK(package_id): UUID
  start_date: DATE
  end_date: DATE
  status: ENUM
  created_at: TIMESTAMP
  updated_at: TIMESTAMP
}

TABLE(SubscriptionPackage, "Subscription Package") {
  PK(id): UUID
  title: VARCHAR(100)
  description: TEXT
  price: DECIMAL(10,2)
  usage_limits: JSON
  discount: DECIMAL(5,2)
  created_at: TIMESTAMP
  updated_at: TIMESTAMP
}

TABLE(PackageFeature, "Package Feature") {
  PK(id): UUID
  FK(package_id): UUID
  feature: VARCHAR(255)
}

TABLE(Payment, "Payment") {
  PK(id): UUID
  FK(subscription_id): UUID
  amount: DECIMAL(10,2)
  payment_date: TIMESTAMP
  payment_method: VARCHAR(50)
  status: ENUM
  created_at: TIMESTAMP
  updated_at: TIMESTAMP
}

' Conversation-related entities
TABLE(AIConversation, "AI Conversation") {
  PK(id): UUID
  FK(client_id): UUID
  created_at: TIMESTAMP
  updated_at: TIMESTAMP
}

TABLE(AIMessage, "AI Message") {
  PK(id): UUID
  FK(conversation_id): UUID
  content: TEXT
  timestamp: TIMESTAMP
  sender_type: ENUM
}

TABLE(ExpertConversation, "Expert Conversation") {
  PK(id): UUID
  FK(client_id): UUID
  created_at: TIMESTAMP
  updated_at: TIMESTAMP
}

TABLE(ExpertMessage, "Expert Message") {
  PK(id): UUID
  FK(conversation_id): UUID
  FK(sender_id): UUID
  content: TEXT
  timestamp: TIMESTAMP
}

' Attachment-related entities
TABLE(Attachment, "Attachment") {
  PK(id): UUID
  FK(message_id): UUID
  file_url: VARCHAR(255)
  file_type: VARCHAR(50)
  created_at: TIMESTAMP
}

' AI-related entities
TABLE(AICompany, "AI Company") {
  PK(id): UUID
  name: VARCHAR(100)
  logo_url: VARCHAR(255)
  api_url: VARCHAR(255)
  status: ENUM
  created_at: TIMESTAMP
  updated_at: TIMESTAMP
}

TABLE(AIModel, "AI Model") {
  PK(id): UUID
  FK(company_id): UUID
  name: VARCHAR(100)
  status: ENUM
  created_at: TIMESTAMP
  updated_at: TIMESTAMP
}

' Notification-related entities
TABLE(Notification, "Notification") {
  PK(id): UUID
  FK(user_id): UUID
  content: TEXT
  timestamp: TIMESTAMP
  read_status: BOOLEAN
}

' Application settings
TABLE(AppSettings, "App Settings") {
  PK(id): UUID
  FK(active_ai_model_id): UUID
  default_ai_message: TEXT
  created_at: TIMESTAMP
  updated_at: TIMESTAMP
}

' Relationships
User "1" -- "0..1" Client
User "1" -- "0..1" AgriculturalExpert
User "1" -- "0..1" Supervisor
User "1" -- "*" Subscription
Subscription "*" -- "1" SubscriptionPackage
SubscriptionPackage "1" -- "*" PackageFeature
Subscription "1" -- "*" Payment
Client "1" -- "*" AIConversation
AIConversation "1" -- "*" AIMessage
Client "1" -- "1" ExpertConversation
ExpertConversation "1" -- "*" ExpertMessage
AIMessage "1" -- "*" Attachment
ExpertMessage "1" -- "*" Attachment
AICompany "1" -- "*" AIModel
User "1" -- "*" Notification
AppSettings "1" -- "1" AIModel
@enduml