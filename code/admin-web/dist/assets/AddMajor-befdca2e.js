import{d as B,bq as D,s as k,r as p,i as l,v as I,e as R,ab as z,w as n,g as d,t as v,h as e,l as o,E as C,G as S,H as U,z as A,I as F,au as G,aa as V}from"./index-47c41640.js";import{N as E}from"./Form-e99ccaf8.js";import{N as K}from"./Grid-4ecf25cd.js";import{N as f}from"./FormItemGridItem-377b31b6.js";import{N as H}from"./Upload-2f21830d.js";import{N as P}from"./Switch-fa214c30.js";import"./FormItem-c6ae1884.js";const T={class:"border-none shadow-none flex flex-col gap-2 p-2 rounded-lg"},$={class:"post-heading mb-1"},J={class:"gtext text-2xl font-bold underlined"},L={style:{display:"flex","justify-content":"flex-end"}},te=B({__name:"AddMajor",props:{visible:{type:Boolean}},emits:["update:visible"],setup(b,{emit:h}){const j=D(),_=b,w=h,u=k(),N=p(null),m=p(!1),t=p({name:"",is_active:!0,image_url:"",id:null,created_at:new Date,updated_at:new Date}),y={name:[{required:!0,message:l("major.nameRequired"),trigger:["input","blur"]}],image:[{required:!0,message:l("major.imageRequired"),trigger:["input","blur"]}]};async function x(){try{m.value=!0;const s=await j.insertMajorAction(t.value);m.value=!1,c.value=!1,u.success("Done Inserted"),console.log("Inserted Major:",s)}catch(s){m.value=!1,console.error("Error inserting major:",s.message),u.error("Failed to insert major")}}const M=async({file:s,onFinish:a,onError:r,onProgress:O})=>{try{const{data:i,error:g}=await V.storage.from("research").upload(`Major/${s.name}`,s.file,{cacheControl:"3600",upsert:!1});if(g)throw g;i&&(t.value.image_url=i.path,u.success("Done"),a())}catch(i){console.error(i),u.error(i.message),r()}},c=I({get(){return _.visible},set(s){w("update:visible",s)}});function q(){return!t.value.name||!t.value.image_url}return(s,a)=>(R(),z(e(G),{show:c.value,"onUpdate:show":a[3]||(a[3]=r=>c.value=r),"mask-closable":!1,"auto-focus":!1,preset:"card",style:{width:"95%","max-width":"640px"}},{default:n(()=>[d("div",T,[d("div",$,[d("div",J,v(e(l)("major.addMajor")),1)]),o(e(E),{ref_key:"formRef",ref:N,model:t.value,rules:y,size:"large"},{default:n(()=>[d("div",null,[o(e(K),{cols:4,span:24,"x-gap":24},{default:n(()=>[o(e(f),{span:12,path:"image",label:e(l)("major.image")},{default:n(()=>[o(e(H),{accept:"image/*","list-type":"image-card",max:1,path:"image","custom-request":M})]),_:1},8,["label"]),o(e(f),{span:12,path:"name",label:e(l)("major.majorName")},{default:n(()=>[o(e(C),{value:t.value.name,"onUpdate:value":a[0]||(a[0]=r=>t.value.name=r),placeholder:"Major Name",clearable:"",onKeydown:a[1]||(a[1]=S(U(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["label"]),o(e(f),{span:12,path:"state",label:e(l)("major.state")},{default:n(()=>[o(e(P),{value:t.value.is_active,"onUpdate:value":a[2]||(a[2]=r=>t.value.is_active=r),size:"large"},null,8,["value"])]),_:1},8,["label"])]),_:1})]),d("div",L,[o(e(A),{type:"primary",style:{width:"100%"},size:"large",loading:m.value,disabled:q(),onClick:x},{default:n(()=>[F(v(e(l)("major.addMajor")),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["model"])])]),_:1},8,["show"]))}});export{te as default};
