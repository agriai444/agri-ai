import{d as $,al as z,am as A,s as D,r as f,i as a,f as E,g as c,t as y,h as e,l,w as n,e as I,E as F,G,H as L,an as V,z as w,I as N,aa as K,X as g,x as j}from"./index-1cb71b58.js";import{N as H}from"./Grid-21e37177.js";import{N as m}from"./FormItemGridItem-4af6fd44.js";import{N as O}from"./Upload-49d6de9f.js";import{N as T}from"./Switch-3e2d018f.js";import{a as X}from"./FormItem-50f38bb6.js";const J={class:"border-none shadow-none flex flex-col gap-2 p-2 rounded-lg"},Q={class:"post-heading mb-1"},W={class:"gtext text-2xl font-bold underlined"},Y={style:{display:"flex","justify-content":"flex-end"}},Z="University",P="research",de=$({__name:"AddUniversity",setup(ee){const p=z(),x=A(),v=D(),U=f(null),u=f(!1),t=f(p.initState()),C={name:[{required:!0,message:a("university.nameRequired"),trigger:["input","blur"]}],country:[{required:!0,message:a("university.countryRequired")}],image:[{required:!0,message:a("university.imageRequired"),trigger:["input","blur"]}]};async function S(){try{u.value=!0,await p.insertDataAction(t.value),u.value=!1,p.showModelAdd=!1,v.success(a("common.addSuccess"))}catch(r){u.value=!1,console.error(a("common.addFailed"),r.message),v.error(a("common.addFailed"),r.message)}}const k=async({file:r,data:s,headers:o,withCredentials:ae,action:te,onFinish:_,onError:B,onProgress:h})=>{try{if(!s)throw new Error("dataParams is undefined");const i={loaded:20,total:100},M=Math.round(i.loaded*100/i.total);h({percent:M});const{data:b,error:d}=await K.storage.from(s.bucket).upload(`${s.folder}/${r.name}`,r.file,{cacheControl:"3600",upsert:!1});if(h({percent:Math.ceil(10)}),d)if(d.statusCode==="409"&&d.error==="Duplicate")t.value.image_url=`${s.folder}/${r.name}`,_();else throw d;b&&(t.value.image_url=b.path,_())}catch(i){console.log(i),v.error(i.message),B()}};function q(){return!t.value.name||!t.value.country_code||!t.value.image_url}const R=r=>g("div",{style:{display:"flex",alignItems:"center"}},[g(j,{icon:"flagpack:"+(typeof r.value=="string"?r.value.toLowerCase():r.value),class:"w-6 h-6"}),g("span",{style:{marginLeft:"8px"}},r.label)]);return(r,s)=>(I(),E("div",J,[c("div",Q,[c("div",W,y(e(a)("university.addUniversity")),1)]),l(e(X),{ref_key:"formRef",ref:U,model:t.value,rules:C,size:"large"},{default:n(()=>[c("div",null,[l(e(H),{cols:4,span:24,"x-gap":24},{default:n(()=>[l(e(m),{span:12,path:"image",label:e(a)("university.image")},{default:n(()=>[l(e(O),{accept:"image/*","list-type":"image-card",max:1,path:"image",data:{folder:Z,bucket:P},"custom-request":k},null,8,["data"])]),_:1},8,["label"]),l(e(m),{span:12,path:"name",label:e(a)("university.universityName")},{default:n(()=>[l(e(F),{value:t.value.name,"onUpdate:value":s[0]||(s[0]=o=>t.value.name=o),placeholder:e(a)("university.universityName"),clearable:"",onKeydown:s[1]||(s[1]=G(L(()=>{},["prevent"]),["enter"]))},null,8,["value","placeholder"])]),_:1},8,["label"]),l(e(m),{span:12,path:"country",label:e(a)("university.country")},{default:n(()=>[l(e(V),{filterable:"",trigger:"hover",value:t.value.country_code,"onUpdate:value":s[2]||(s[2]=o=>t.value.country_code=o),options:e(x).getCountryOption(),"render-label":R},{default:n(()=>[l(e(w),null,{default:n(()=>[N(y(e(a)("university.country")),1)]),_:1})]),_:1},8,["value","options"])]),_:1},8,["label"]),l(e(m),{span:12,path:"state",label:e(a)("university.state")},{default:n(()=>[l(e(T),{value:t.value.is_active,"onUpdate:value":s[3]||(s[3]=o=>t.value.is_active=o),size:"large"},null,8,["value"])]),_:1},8,["label"])]),_:1})]),c("div",Y,[l(e(w),{type:"primary",style:{width:"100%"},size:"large",loading:u.value,disabled:q(),onClick:S},{default:n(()=>[N(y(e(a)("university.addUniversity")),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["model"])]))}});export{de as _};
