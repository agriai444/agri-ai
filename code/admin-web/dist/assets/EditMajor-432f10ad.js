import{d as $,bq as z,s as C,r as n,i,v as D,bi as F,e as I,ab as S,w as u,g as d,t as _,h as e,l as r,E,G,H as V,z as K,I as A,au as H,aa as L}from"./index-47c41640.js";import{N as P}from"./Form-e99ccaf8.js";import{N as T}from"./Grid-4ecf25cd.js";import{N as v}from"./FormItemGridItem-377b31b6.js";import{N as J}from"./Upload-2f21830d.js";import{N as O}from"./Switch-fa214c30.js";import"./FormItem-c6ae1884.js";const Q={class:"myglass flex flex-col gap-2 rounded-lg"},W={class:"post-heading mb-1"},X={class:"gtext text-2xl font-bold underlined"},Y={style:{display:"flex","justify-content":"flex-end"}},ue=$({__name:"EditMajor",props:{visible:{type:Boolean},row:{}},emits:["update:visible"],setup(h,{emit:j}){const y=z(),t=h,N=j,m=C(),x=n(null),p=n(!1),f=n({name:t.row.name,state:!!t.row.state,image:t.row.image_url,updated_at:t.row.updated_at}),a=n({name:t.row.name,state:!!t.row.state,image:t.row.image_url,updated_at:t.row.updated_at}),M={name:[{required:!0,message:i("major.nameRequired"),trigger:["input","blur"]}],image:[{required:!0,message:i("major.imageRequired"),trigger:["input","blur"]}]};async function B(){try{p.value=!0;const o=await y.updateMajorAction({id:t.row.id||"",updates:a.value});p.value=!1,g.value=!1,m.success("Done updated"),console.log("updated Major:",o)}catch(o){p.value=!1,console.error("Error updating major:",o.message),m.error("Failed to update major")}}const R=async({file:o,onFinish:s,onError:l,onProgress:ee})=>{try{const c="Major",U="research",{data:w,error:b}=await L.storage.from(U).upload(`${c}/${o.name}`,o.file,{cacheControl:"3600",upsert:!1});if(b)throw b;w&&(a.value.image_url=w.path,m.success("Done"),s())}catch(c){console.error(c),m.error(c.message),l()}},g=D({get(){return t.visible},set(o){N("update:visible",o)}}),k=n([{id:"react",name:a.value.image_url||"",status:"finished",url:`${F}/${bucket}/${a.value.image_url}`}]);function q(){return!a.value.name||!a.value.image_url||a.value.name===f.value.name&&a.value.state===f.value.state&&a.value.image_url===f.value.image_url}return(o,s)=>(I(),S(e(H),{show:g.value,"onUpdate:show":s[3]||(s[3]=l=>g.value=l),"mask-closable":!1,"auto-focus":!1,preset:"card",style:{width:"95%","max-width":"640px"}},{default:u(()=>[d("div",Q,[d("div",W,[d("div",X,_(e(i)("major.editMajor")),1)]),r(e(P),{ref_key:"formRef",ref:x,model:e(a),rules:M,size:"large"},{default:u(()=>[d("div",null,[r(e(T),{cols:4,span:24,"x-gap":24},{default:u(()=>[r(e(v),{span:12,path:"image",label:e(i)("major.image")},{default:u(()=>[r(e(J),{accept:"image/*","list-type":"image-card",min:1,max:1,path:"image","default-file-list":k.value,"custom-request":R},null,8,["default-file-list"])]),_:1},8,["label"]),r(e(v),{span:12,path:"name",label:e(i)("major.majorName")},{default:u(()=>[r(e(E),{value:e(a).name,"onUpdate:value":s[0]||(s[0]=l=>e(a).name=l),placeholder:"Major Name",clearable:"",onKeydown:s[1]||(s[1]=G(V(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["label"]),r(e(v),{span:12,path:"state",label:e(i)("major.state")},{default:u(()=>[r(e(O),{value:e(a).state,"onUpdate:value":s[2]||(s[2]=l=>e(a).state=l),size:"large"},null,8,["value"])]),_:1},8,["label"])]),_:1})]),d("div",Y,[r(e(K),{type:"primary",style:{width:"100%"},size:"large",loading:p.value,disabled:q(),onClick:B},{default:u(()=>[A(_(e(i)("major.editMajor")),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["model"])])]),_:1},8,["show"]))}});export{ue as default};
